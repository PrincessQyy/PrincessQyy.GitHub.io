---
layout:     post
title:      "【Linux】网络排错"
date:       2017-05-01 15:27:00
author:     "Yuki"
---

我们经常可能遇到网络不通的问题，这类问题其实主要可以归类为硬件问题和软件问题。硬件问题比较麻烦，因为需要通过一些专门的设备来分析硬件，至于软件问题，绝大部分是设置错误或者逻辑错误，比较好排查。下面就从这两个方面来看看怎么进行网络排错吧~(•̀ᴗ•́)و ̑̑

#### 硬件问题

**网线问题**

网线问题基本上要注意以下几点：

* 网线被截断
* 网线过度扭曲造成信号不良
* 网络接头品质不佳
* 网络接头与设备（如hub）接触不良

**网络、HUB、Router等网络设备问题**

设备问题主要有以下几类：

* 网卡不稳定、质量不佳，或与系统兼容性不好
* 网络设备的接头经常插拔造成的接触不良、信号衰减
* 网络设备所处环境恶劣造成宕机问题（如热宕）
* 网络设备使用不当（如switch经常插电/断电容易损坏）

**设备配置的原则**

* 网线使用错误
* 网线架设过长，导致信号衰减严重
* 其他噪声的干扰，如网线附近有较强电磁场
* 局域网有个543原则：5个网段、4个增益器（信号放大器）、3个计算机群体（5个网段里只有三个网段可以用来安装计算机）

#### 软件问题及其处理

这里就直接将解决方案和问题合一块儿了Ｏ(≧口≦)Ｏ

**网卡工作确认**

* 确定网卡是否驱动成功

用命令 `dmesg | grep eth` 或` lspci | grep Ethernet` 来获取相关设备和模块的对应。

* 确定可以手动建立IP参数

可以利用ifconfig来给网卡一个地址，然后ping这个地址看看是否能ping 通，操作如下图：
<img src="../../../../../img/blogs/Tshoot/01.png">

**局域网内设备检测**

* IP参数是否设置正确

确定IP/netmask是对的。

* Gateway和DNS的设置

在Gateway填写IP路由器或NAT的IP，在DNS的IP设置中填写根服务器名称。

**取得正确的IP参数**

要顺利连接上Internet的话，必须可以跟public IP进行沟通才行，常见的方法有ADSL、Modem、学术网络、电话拨号等。在Centos中，可以通过修改/etc/sysconfig/network-scripts/ifcfg-enp0s3连接到某个ISP去。

连接上后，用ifconfig查看是否取得了正确的ip。

**确认路由表的规则**

可以ping根域名服务器的IP看是否能ping通，若有响应，证明可以连接到Internet了；若无响应，则考虑内部网往外传输数据要通过路由，可能就是路由或者防火墙出问题了。这时候可以通过`route -n `来查看路由表，注意查看Gateway的设置有没有错，还有就是可能会忘记设置默认路由，这时候就需要用`route add`来添加路由信息了。

**主机名与IP查询的DNS错误**

如果你发现可以连接到根域名服务器，但是无法使用浏览器访问某个域名的话，很可能就是DNS解析的问题，可以在/etc/resolve.conf中查看配置是否有误。

还有就是若主机改了主机名，该主机名却无法有一个正确的IP对应，那么主机在开机时，可能会有好几秒的延误，这时候就需要在/etc/hosts中添加主机名和IP的对应，这对于内部网络是很重要的设置。

**NAT服务器或IP路由器出现问题**

NAT主机上的防火墙设置是否合理、IP路由器上是否设置了过滤机制等，都会影响对外连接是否成功。

**Internet的问题**

想要确定问题是否来自Internet，可以用traceroute查看问题来自哪个地方。

**服务器问题**

服务器问题主要有以下几种：

* 服务器并没有开放该项服务：例如主机关闭了Telnet，那使用Telnet去连接是无法连接上的
* 主机权限设置错误：假设某目录权限为drwx------，该目录所属root用户，你却将该目录开放给WWW来浏览，由于WWW无法进入该目录，所以当然无法正确的呈现给客户端。
* 安全机制设置错误：SELinux可能会阻挡某些服务的提供。
* 防火墙问题：防火墙设置错误也是一个常见的问题，可以使用tcpdump来跟踪数据包的流向，以顺利了解防火墙是否设置错误。





 



