---
layout:     post
title:      "【SQL】数据模式"
date:       2017-01-18 13:39:00
author:     "Yuki"

---
## 为什么需要多张表？ ##

在了解数据模式之前，我们需要知道，为什么需要多张表？随着表中数据的增多，我们的数据很难保持精简整洁，这也给我们的查询带来了很多麻烦，因此，我们需要跳出一张表的思维模式，把不符合原子性的列移入新的表。
## 数据模式 ##
现在我们知道需要多张表了，但是我们依然需要找出数据所属的模式，思考表与表之间的关系。接下来讨论三种可能的模式：一对一、一对多、多对多。
***
1. 数据模式：一对一

一对一模式，顾名思义，就是指表A中的某条记录在表B中有且只有一条相对应的记录。例如，某家公司的每个员工都只有一个社会安全号，一个社会安全号也只会对应一个人，这就是简单的一对一关系。
如下图：

![](G:/MyBlog/img/2.png) 

在schema图中，一对一关系连线是单纯的实线。

事实上，我们会用到一对一关系的机会非常少，因为一对一数据通常留在主表会更合理些。除非抽出数据能让我们设计更快的查询；或者有的列还包含未知的值，可以单独存储这一列；再者，有的数据我们不希望被频繁的访问，例如员工的社会安全号；还有数据量很大时，例如BLBO类型的数据，这类数据也适合存放在另一张表中。


2. 数据模式：一对多

一对多模式，表示A表中的某条记录可以在B表中查询到多条记录，但B表中的一条记录只会对应到A表中的某一条记录。例如，一本图书只有一个出版商，但是一个出版商可以出版多本图书。
如下图：
![](G:/MyBlog/img/2.2.png) 

用带箭头的连接线来表示一对多的关系。

在一对一和一对多的数据模式中，我们可以通过添加外键的方法来让两张表产生联系。

* 外键：外键是表中某一列，它引用自另一个表的主键。

3. 数据模式：多对多

多对多模式：表示A表中的某条记录可以在B表中查询到多条记录，B表中的某条记录也可以在A表中查询到多条记录。例如，一个女士拥有很品牌的鞋，某一品牌的鞋子也可以被多个女士所拥有。
如下图：
![](G:/MyBlog/img/2.3.png) 

用双向箭头的连接线来表示多对多的关系。

在多对多的数据模式中，我们需要一个中间桥梁来建立两个表之间的关系，这个中间桥梁就称为：junction table（连接表）。若是直接连接两个多对多数据模式的表，因为其本质会产生重复的数据，所以我们需要取出两张表中的主键，存放在另一张表中，由两个一对多的关系建立多对多的关系。
## 表中数据的关系

讨论完表间的关系，我们来讨论下表中的数据关系。在此之前，我们需要再了解一个概念：组合键。

* 组合键：组合键就是由多个数据列构成的主键，组合各列后形成具有唯一性的键。

可能有的人会有疑问，为什么要用组合键？我们知道，不是所有表都有独一无二的可以作为主键的列，在不具有独一无二的列的表中，我们就需要利用列和列来创建一个组合主键。
终于可以来看看表中数据的关系了，有时候我们会发现，当表中某一列的数据改变后，另一列会随着这列数据的改变而改变，例如，若某张人物信息表中出生日期改变了，那么此人的年龄也会随之改变，我们称这种关系为函数依赖关系。函数依赖关系有两种：部分函数依赖和传递函数依赖。

* 部分函数依赖：指非主键的列依赖于组合主键的某个部分，但不是完全依赖于组合主键。
* 传递函数依赖：指非主键的列依赖于另一个非主键的列。

## 多张表的数据库设计

在设计多张表时，我们需要让表符合第三范式（3NF），这会使你的查询更为简单高效。
在谈论第三范式之前，我们首先要来说说第一范式（1NF）和第二范式（2NF）。

其实在之前谈到的为什么需要多张表时，我们提到了要把不符合原子性的列移入新的表，这其实也是使我们的表满足第一范式。在任何一个关系数据库中，第一范式（1NF）是对关系模式的基本要求，不满足第一范式（1NF）的数据库就不是关系数据库。

【1NF】

* 规则一：数据列只包含具有原子性的值
* 规则二：没有重复的数据组

满足第二范式是为了明析表的主键和其他数据之间的关系（如果你的表中有人工主键而没有组合主键，则直接符合2NF）。

【2NF】

* 规则一：先符合1NF
* 规则二：没有部分函数依赖性

终于到了第三范式

【3NF】

* 规则一：先符合2NF
* 规则二：没有传递函数依赖性

数据库的设计范式是数据库设计所需要满足的规范，满足这些规范的数据库是简洁的、结构明晰的；同时，不会发生插入（insert）、删除（delete）和更新（update）操作异常。反之则是乱七八糟，不仅给数据库的编程人员制造麻烦，而且可能存储了大量不需要的冗余信息。