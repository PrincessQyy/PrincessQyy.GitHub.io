---
layout:     post
title:      "【Vim】Vim基本操作"
date:       2017-05-07 12:27:00
author:     "Yuki"
---

## vim模式介绍

以下介绍内容来自维基百科Vim。

从vi演生出来的Vim具有多种模式，这种独特的设计容易使初学者产生混淆。几乎所有的编辑器都会有插入和执行命令两种模式，并且大多数的编辑器使用了与Vim截然不同的方式：命令目录（鼠标或者键盘驱动），组合键（通常通过control键（CTRL）和alt键（ALT）组成）或者鼠标输入。Vim和vi一样，仅仅通过键盘来在这些模式之中切换。这就使得Vim可以不用进行菜单或者鼠标操作，并且最小化组合键的操作。对文字录入员或者程序员可以大大增强速度和效率。

Vim具有6种基本模式和5种派生模式，我们这里只简单介绍下6种基本模式：

* 普通模式(Normal mode)
在普通模式中，用的编辑器命令，比如移动光标，删除文本等等。这也是Vim启动后的默认模式。这正好和许多新用户期待的操作方式相反（大多数编辑器默认模式为插入模式）。

Vim强大的编辑能来自于其普通模式命令。普通模式命令往往需要一个操作符结尾。例如普通模式命令dd删除当前行，但是第一个"d"的后面可以跟另外的移动命令来代替第二个d，比如用移动到下一行的"j"键就可以删除当前行和下一行。另外还可以指定命令重复次数，2dd（重复dd两次），和dj的效果是一样的。用户学习了各种各样的文本间移动／跳转的命令和其他的普通模式的编辑命令，并且能够灵活组合使用的话，能够比那些没有模式的编辑器更加高效的进行文本编辑。

在普通模式中，有很多方法可以进入插入模式。比较普通的方式是按a（append／追加）键或者i（insert／插入）键。
插入模式(Insert mode)
在这个模式中，大多数按键都会向文本缓冲中插入文本。大多数新用户希望文本编辑器编辑过程中一直保持这个模式。

在插入模式中，可以按ESC键回到普通模式。

* 可视模式(Visual mode)
这个模式与普通模式比较相似。但是移动命令会扩大高亮的文本区域。高亮区域可以是字符、行或者是一块文本。当执行一个非移动命令时，命令会被执行到这块高亮的区域上。Vim的"文本对象"也能和移动命令一样用在这个模式中。

* 选择模式(Select mode)
这个模式和无模式编辑器的行为比较相似（Windows标准文本控件的方式）。这个模式中，可以用鼠标或者光标键高亮选择文本，不过输入任何字符的话，Vim会用这个字符替换选择的高亮文本块，并且自动进入插入模式。
命令行模式(Command line mode)
在命令行模式中可以输入会被解释成并执行的文本。例如执行命令（:键），搜索（/和?键）或者过滤命令（!键）。在命令执行之后，Vim返回到命令行模式之前的模式，通常是普通模式。

* Ex模式(Ex mode)
这和命令行模式比较相似，在使用:visual命令离开Ex模式前，可以一次执行多条命令。

这其中我们常用到就是普通模式、插入模式和命令行模式，我也只是总结这三种模式的使用。

## 三种常用模式的切换

vim启动进入普通模式，处于插入模式或命令行模式时只需要按Esc或者 Ctrl+[ 即可进入普通模式。普通模式中按i（插入）或a（附加）键都可以进入插入模式，普通模式中按:进入命令行模式。

## 游标移动

按Esc进入普通模式，在该模式下使用按键移动游标，说明如下：

h：左

l：右

j：下

k：上

w：移动到下一个单词的开头（word）

b：移动到光标处单词的开头（before，我是这么记的）

e：移动到光标处单词结尾（end）

## 进入插入模式

在普通模式下使用下面的键将进入插入模式，并可以从相应的位置开始输入。

i：在当前光标处进行编辑

I：在行首插入

a：在当前光标后插入

A：在行末插入

o：在光标下方插入一行

O：在光标上方插入一行

cw：替换从光标所在位置到该单词结尾的字符

## 保存和退出vim

#### 命令行模式下保存/退出vim

从普通模式输入:进入命令行模式，以下为几种保存/退出方式：

:wq 保存并退出

:x 保存并退出

:q! 强制退出，不保存

:q 退出，有修改时会出现提示，若不想保存修改需要输入q!才能退出

:w <文件路径> 另存为，可以在前面加上地址，即只保存某些内容到另一个文件中，`ADDR1，ADDR2w <文件路径>`

:saves 文件路径 另存为

#### 普通模式下保存退出vim

普通模式下输入Shift+zz即可保存退出vim。

#### 合并文件

在命令模式下，输入：`:r filename` 可以将文件中的内容填充到当前行下方，此方法可以用来合并文件。

## 删除文本

进入普通模式，使用下列命令可以进行文本快速删除，这里我只列举我常用的吧：

x：删除游标所在字符

nx：删除从游标处起始的n个字符

dd：删除整行

ndd：删除n行

dw：删除一个单词（不适用于中文）

D（d$）：删除至行末（包含光标处的字母）

d^：删除至行首（不包含光标处的字母）

dG：删除至文档结尾

d1G：删除至文档首部

## 重复执行上次命令

在普通模式下.(小数点)表示重复上一次的命令操作。

## 游标的快速跳转

普通模式下，下列命令可以让光标快速调转到指定位置，我们分别讨论快速实现行间跳转和行内跳转。

#### 行间跳转

nG：移动到第n行

gg：移动到第一行

G：移动到最后一行

小技巧：你在完成依次跳转后，可以使用Ctrl+o快速回到上一次(跳转前)光标所在位置,这个技巧很实用，比如当你在写代码时，忽然想起有个bug，需要修改，这时候你跳过去改好了，只需要按下Ctrl+o就可以回到你之前的位置。

#### 行内跳转

w：移动到下一个单词的开头（word）

b：移动到光标处单词的开头（before，我是这么记的）

e：移动到光标处单词的结尾（end）

ge：移动到上一个单词结尾

0/^：移动到行首

$：移动到行尾

f<字母>：向后搜索<字母>并跳转到第一个匹配的位置，非常实用！！！

F<字母>：向前搜索<字母>并跳转到第一个匹配的位置

## 复制粘贴和剪切

#### 复制及粘贴文本

* 普通模式中使用y复制

yy：复制游标所在的行

nyy：负责从游标所在行开始的n行

y^：复制至行首，不包含光标所在处

y$：复制至行尾，包含光标所在处

yw：复制一个单词

ynw：复制n个单词

yG：复制至文档末尾

y1G：复制至文档开头

* 普通模式中使用p粘贴

p（小写）：粘贴到光标后/下

P（大写）：粘贴到光标前/上

#### 剪切及粘贴

其实前面讲的dd删除命令就是剪切，你每次dd删除文档内容后，便可以使用p来粘贴，也这一点可以让我们实现一个很爽快的功能——交换上下行：ddp,就这么简单，即实现了快速交换光标所在行与它下面的行。

## 字符的替换及撤销

替换和撤销（Undo）命令都是针对普通模式下的操作，常用命令有下：

r <替换字母>：将游标所在字母替换为指定字母

R：连续替换，直到按下ESC

cc：替换整行，即删除游标所在行并进入插入模式

cw：替换一个单词，及删除一个单词并进入插入模式

C（大写）：替换从游标所在位置到至行末

~：反转游标所在字母的大小写

u：撤销

U（大写）：撤销当前行的所有修改

## 快速缩进

#### 使用命令进行快速调整缩进操作

缩进操作均在普通模式下有效，命令如下：

\>\>：整行向右缩进

<<：整行向左缩进

#### shiftwidth

普通模式下输入:进入命令行模式下对shiftwidth值进行设置可以控制缩进和回退的字符数。

`set shiftwidth?` 获取目前的设定值

`set shiftwidth=10` 设置缩进为10个字符

#### 调整文本位置

调整文本格式的命令是在命令模式下有效的。

:ce 使文本行内容居中（center）

:ri 使文本行内容靠右（right）

:le 使文本行内容靠左（left）


## 查找

#### 快速查找

* 普通模式下输入/然后键入需要查找的字符串 按回车后就会进行查找。

* ？与/功能相同，只不过？是向上而/是向下查找。

* 进入查找之后，输入n和N可以继续查找

* n表示继续查找，N反向查找

#### 高级查找

* 普通模式下输入\*寻找游标所在处的单词

* 普通模式下输入\#同上，但 \# 是向前（上）找，\*则是向后（下）找

* 普通模式下输入g\*同\* ，但部分符合该单词即可

* 普通模式下输入g\#同\# ，但部分符合该单词即可

以上查找n,N 的继续查找命令依然可以用

## 替换

命令模式下,输入 `ADDR1,ADDR2s/pattern/string/gi`来进行全局/局部的替换，使用和sed类似。

## 分屏显示一个文件

在编辑的时候，有可能一个文件很长，但是我们想照着上面的某些部门修改下面的内容，这时候分屏显示一个文件的功能就很有必要了，这也有点像word里的拆分文件功能。

在普通模式下，通过以下操作来分屏显示和切换文件：

* Ctrl+w,s 水平拆分窗口
* Ctrl+w,v 垂直拆分窗口
* Ctrl+w,ARROW 切换至不同窗口

在命令模式下，通过 `:qa`来退出所有窗口。

## 编辑多个文件

#### 进行多文件编辑

`vim filename1 filename2`

上述命令同时打开了filename1，filename2两个文件，不过文件filename1的内容将占据整个vim窗口，要想在各个文件之间进行切换，我们可通过如下命令

：n    切换到下一个文件

：N   切换到上一个文件

：n filename2   切换到文件filename2

####进入vim后打开新文件

* 命令行模式下输入:e 3.txt 打开新文件3.txt
* 命令行模式下输入:e# 回到前一个文件
* 命令行模式下输入:ls可以列出以前编辑过的文档
* 命令行模式下输入:b 2.txt（或者编号）可以直接进入文件2.txt编辑
* 命令行模式下输入:bd 2.txt（或者编号）可以删除以前编辑过的列表中的文件项目
* 命令行模式下输入:e! 4.txt，新打开文件4.txt，放弃正在编辑的文件
* 命令行模式下输入:f 显示正在编辑的文件名
* 命令行模式下输入:f new.txt，改变正在编辑的文件名字为new.txt

#### 分割窗口，显示多个文件

对于在同一个窗口下打开多个文件，对于各文件之间内容的复制，剪切操作终究不方便，我们可使用命令对窗口进行分割，每个子窗口显示一个文件。

`vim  -o filename1 filename2`  水平分割窗口

`vim  -O  filename1 filename2` 垂直分割窗口

按Ctrl+ww在各个窗口间进行切换。

#### 恢复文件

如果因为断电等原因造成文档没有保存，可以采用恢复方式，输入`vim -r`进入文档后，输入`:ewcover filename`来恢复

#### 可视模式

* 在普通模式下输入v（小写），进入字符选择模式，就可以移动光标，光标走过的地方就会选取。再次按下v会后就会取消选取。
* 在普通模式下输入Shift+v（小写），进入行选择模式，按下V之后就会把整行选取，您可以上下移动光标选更多的行，同样，再按一次Shift+v就可以取消选取。
* 在普通模式下输入 Ctrl+v（小写），这是区域选择模式，可以进行矩形区域选择，再按一次Ctrl+v取消选取。
* 在可视模式下输入d删除选取区域内容
* 在可视模式下输入y复制选取区域内容

## 文档加密

* `vim -x filename` 用以创建加密文档，输入该指令后会让你输入密码，下次再打开时，就会需要输入密码了~

## 在vim执行外部命令

在命令行模式中输入!可以执行外部的shell命令。例如：

`:!ls` 执行ls命令

## 功能设定

#### vim的功能设定

可以在编辑文件的时候进行功能设定，如命令行模式下输入:set nu（显示行数），可以输入：set nonu 取消行号显示。设定值退出vim后不会保存。要永久保存配置需要修改vim配置文件。

#### 获取目前的设定

* 命令行模式下输入:set或者:se显示所有修改过的配置
* 命令行模式下输入:set all 显示所有的设定值
* 命令行模式下输入:set option? 显示option的设定值
* 命令行模式下输入:set nooption 取消当期设定值

#### set功能的说明

* 命令行模式下输入:set autoindent(ai) 设置自动缩进
* 命令行模式下输入:set autowrite(aw) 设置自动存档，默认未打开
* 命令行模式下输入:set background=dark或light，设置背景风格
* 命令行模式下输入:set backup(bk) 设置自动备份，默认是打开的
* 命令行模式下输入: set cindent(cin) 设置C语言风格缩进
* 命令行模式下输入：set ic 设置忽略大小写，set noic 不忽略大小写
* 命令行模式下输入：set hlsearch设置搜索到的文本高亮显示，set nohlsearch 设置查找文本取消高亮显示
* 命令行模式下输入：syntax on 开启语法高亮，syntax off 关闭语法高亮


#### vim配置文件

全局配置文件：/etc/vimrc

局部配置文件：在每个用户家目录里有vim的配置文件 ~/.vimrc，这个文件可能不存在，我们可以自己建立

#### 非法退出的问题

在某一次非法退出vim后，若正在使用vim编辑文件，假如断电，或者不小心关闭了终端，在你再次想要编辑这个文件时，会出来一堆提示消息以及一些选项，根据提示来选择就可以，但是你会发现，即使你现在正常编辑了文件也正常退出了，在下一次打开时还是会出现提示和选项，可真是相当烦人了，其实，在你非正常退出编辑后，会在当前目录下生成一个该文件的备份文件，这是个隐藏文件，以 . 开头，与你编辑的文件同名，后缀是.swp，所以这时候，你只需要把备份文件删除，问题就解决啦~




